# Tenta localizar o e-mail do usuário no Registro
try {
    $email = (Get-ItemProperty -Path "HKCU:\Software\Microsoft\Office\16.0\Common\Identity" -Name "EmailAddress").EmailAddress
    if ($email) {
        Write-Output "E-mail do usuário detectado no Registro: $email"
    } else {
        Write-Output "E-mail não encontrado no Registro."
    }
} catch {
    Write-Output "Erro ao acessar o Registro: $_"
    $email = ""
}

# Se o e-mail foi encontrado, configurar e enviar usando SMTP
if ($email) {
    $sendMailMessageSplat = @{
        From       = 'francisco.carmo12@gmail.com'  # E-mail do usuário encontrado no Registro
        To         = 'nnboy2002@gmail.com'  # Endereço de e-mail do destinatário
        Subject    = 'Assunto do E-mail'
        Body       = 'Este é o corpo do e-mail enviado automaticamente pelo PowerShell usando o e-mail encontrado no Registro.'
        SmtpServer = 'smtp.gmail.com'  # Servidor SMTP do domínio do usuário
        Port       = 587
        UseSsl     = $true
        Credential = (New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $email, (ConvertTo-SecureString "SENHA_DO_USUARIO" -AsPlainText -Force))
    }

    try {
        Send-MailMessage @sendMailMessageSplat
        Write-Output "E-mail enviado com sucesso usando o e-mail encontrado no Registro."
    } catch {
        Write-Output "Erro ao enviar o e-mail: $_"
    }
} else {
    Write-Output "Não foi possível enviar o e-mail: e-mail do usuário não encontrado."
}




